<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ArtPortal Loading</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="LoaderWrapper">
      <div class="LoaderContent">
        <div id="topicon">
            <img src="../../assets/icon-white.png" height="auto" width="100px">
        </div>
        <div class="loading-wrapper">
            <div class="bar one"></div>
            <div class="bar two"></div>
            <div class="bar three"></div>
          </div>
        <span id="loadingText">Checking for updates</span>
        <progress id="downloadProg" value="0" max="100"></progress>
        <span id="downloadSpeed"></span>

        <div id="footer">
            <small>Having trouble loading?</small>
            <br>
            <a href="https://twitter.com/khaishins"><i class="fa-brands fa-twitter"></i> Tweet Me</a>
        </div>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require("electron")

      ipcRenderer.on('message', (event, data) => {
          console.log('received data', data)
          document.getElementById('loadingText').innerHTML = data
          if(data == 'Downloading update') {
            document.getElementById('downloadProg').style.display = 'block'
            document.getElementById('downloadSpeed').style.display = 'block'
          }

          if(data == 'Update downloaded') {
            document.getElementById('downloadProg').style.display = 'none'
            document.getElementById('downloadSpeed').style.display = 'none'
          }
      })

      ipcRenderer.on('loadprog', (event, data) => {
        console.log('received data', data)
        let val = data.replace('%', '')
        document.getElementById('downloadProg').value = val
      })

      ipcRenderer.on('downloadspeed', (event, data) => {
        console.log('received data', data)
        document.getElementById('downloadSpeed').innerHTML = `${(parseFloat(data)/125000/8).toFixed(2)} MB/s`
      })
    </script>
  </body>
</html>